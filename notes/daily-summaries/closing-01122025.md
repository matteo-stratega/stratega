# Session Closing - 1 Dicembre 2025

## Focus della Sessione
Debugging e fix del workflow n8n `content-gen-prod` per generazione articoli blog.

---

## Cosa Abbiamo Fatto

### 1. Setup MCP n8n
- Configurato accesso MCP a n8n per controllo workflow da Claude Code

### 2. Debug Information Extractor
- **Problema 1:** JSON wrappato in backticks markdown (` ```json ``` `)
- **Fix:** Aggiunto Code node per strip backticks + modificato prompt template

- **Problema 2:** Output troncato (limite token)
- **Fix:** Ridotto temporaneamente lo schema (rimossi PAA, Sources, alcuni ToC)

- **Problema 3:** Modello Claude Sonnet troppo costoso e non rispetta istruzioni
- **Fix:** Switchato a Claude Haiku 3.5

### 3. Fix Supabase
- **Problema:** Tabella `blog_pages` aveva solo 5 colonne
- **Fix:** Aggiunto 27 colonne via SQL (headline, subtitle, sections, takeaways, etc.)

- **Problema:** Nodo store_article configurato come Update invece di Create
- **Fix:** Cambiato a Create + configurato Inputs to Ignore

### 4. Primo Articolo Generato
- Keyword: "B2B lead generation without ads"
- Salvato in Supabase con id: 1
- **Status:** Funziona ma qualit riconoscibilmente AI

---

## Stato Attuale

| Item | Status |
|------|--------|
| Workflow funzionante | Done |
| Primo articolo generato | Done |
| Qualit articolo | Needs improvement |
| Schema completo (PAA, Sources) | Pending |
| Test su altri case | Pending |
| Deploy produzione | Pending |

---

## Prossima Sessione (~2 ore stimate)

### Priorit 1: Qualit Articolo
L'articolo attuale  riconoscibile come AI-generated. Per vendere a B2B companies serve qualit "human-made":
- Migliorare prompt Gemini (tono, stile, esempi concreti)
- Aggiungere variabilit nella struttura
- Ridurre pattern ripetitivi
- Testare diversi temperature settings

### Priorit 2: Schema Completo
- Ripristinare campi PAA, Sources, FAQ
- Aumentare max_tokens nel nodo Anthropic
- Testare che non tronchi

### Priorit 3: Testing
- Testare su 2-3 keyword diversi
- Verificare consistenza output
- Validare salvataggio Supabase

### Priorit 4: Deploy
- Attivare Schedule Trigger
- Monitorare prime esecuzioni automatiche

---

## Note Tecniche per Prossima Sessione

### Crediti Utilizzati
- Anthropic: ~$3.40 di $5 (rimangono ~$1.60)
- Gemini: Quota giornaliera esaurita (50 req/day free tier)

### File Modificati
- Workflow n8n `content-gen-prod` (ID: gQxLO22JXLBPc4Hp)
- Tabella Supabase `blog_pages` (27 nuove colonne)

### Pinned Data
- Dati pinnati su `gemini-research` e `set_field_names` per testing senza consumare API

---

## Decisioni Prese

| Decisione | Rationale |
|-----------|-----------|
| Claude Haiku invece di Sonnet | Costo minore, pi obbediente su output format |
| Schema ridotto per test | Evitare troncamento output |
| Create invece di Update | Tabella era vuota, pi semplice per test |

---

*Tempo speso: ~3 ore*
*Prossima sessione: ~2 ore per raggiungere qualit target*

---

Archimede - Session closed
